group: edge
dist: trusty

language: go

go:
  - 1.x
  - 1.6
  - 1.7.x
  - 1.8.x
  - master

install: true

before_install:
  # install docker-compose
  - sudo apt update
  - sudo apt install -y python-pip curl jq libxml2-utils
  - sudo pip install --upgrade httpie docker-compose
  - sudo usermod -aG docker $(whoami)
  # kill on ports
  - true | sudo kill $(sudo lsof -t -i:5432)

script:
  - export GOPATH="$GOPATH:$PWD"

  - >
    for goApp in 06-http-server-even-more-simpler \
                 05-http-serve-file \
                 04-file-server; do

      go install $goApp
      ./bin/$goApp &
      sleep 1
      curl localhost:8080/files/index.html
      http :8080/files/index.html
      http :8080/files/favicon.ico
      killall -9 $goApp;

  - >
    for goApp in 03-handler-func \
                 02-http-handler \
                 01-webapp; do

      go install $goApp;
      ./bin/$goApp &
      sleep 1;
      curl localhost:8080;
      http :8080;
      killall -9 $goApp;

    done;
